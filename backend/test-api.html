<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API - Juego 3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        h2 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }

        .success {
            color: #28a745;
            font-weight: bold;
        }

        .error {
            color: #dc3545;
            font-weight: bold;
        }

        .info {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .user-info {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .hidden {
            display: none;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .leaderboard-item .rank {
            font-weight: bold;
            color: #667eea;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üéÆ Test API - Juego 3D</h1>
            
            <div class="info">
                <strong>Estado del servidor:</strong> <span id="serverStatus">Verificando...</span>
            </div>

            <div id="userInfo" class="user-info hidden">
                <strong>Usuario autenticado:</strong> <span id="userName"></span><br>
                <strong>Puntaje m√°s alto:</strong> <span id="highestScore">0</span>
                <button onclick="logout()" style="margin-top: 10px; width: auto;">Cerrar sesi√≥n</button>
            </div>
        </div>

        <div class="card">
            <div class="tabs">
                <div class="tab active" onclick="showTab('auth')">Autenticaci√≥n</div>
                <div class="tab" onclick="showTab('scores')">Puntajes</div>
                <div class="tab" onclick="showTab('stats')">Estad√≠sticas</div>
            </div>

            <!-- Tab: Autenticaci√≥n -->
            <div id="authTab" class="tab-content active">
                <h2>Registrar Usuario</h2>
                <div class="form-group">
                    <label>Nombre:</label>
                    <input type="text" id="registerName" placeholder="Tu nombre">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="registerEmail" placeholder="tu@email.com">
                </div>
                <div class="form-group">
                    <label>Contrase√±a:</label>
                    <input type="password" id="registerPassword" placeholder="M√≠nimo 6 caracteres">
                </div>
                <button onclick="register()">Registrar</button>
                <div id="registerResult" class="result hidden"></div>

                <h2 style="margin-top: 30px;">Iniciar Sesi√≥n</h2>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="loginEmail" placeholder="tu@email.com">
                </div>
                <div class="form-group">
                    <label>Contrase√±a:</label>
                    <input type="password" id="loginPassword" placeholder="Tu contrase√±a">
                </div>
                <button onclick="login()">Iniciar Sesi√≥n</button>
                <div id="loginResult" class="result hidden"></div>
            </div>

            <!-- Tab: Puntajes -->
            <div id="scoresTab" class="tab-content">
                <h2>Guardar Puntaje</h2>
                <div class="form-group">
                    <label>Puntaje:</label>
                    <input type="number" id="scoreValue" placeholder="1000">
                </div>
                <div class="form-group">
                    <label>Nivel:</label>
                    <input type="number" id="scoreLevel" placeholder="1" value="1">
                </div>
                <button onclick="saveScore()">Guardar Puntaje</button>
                <div id="scoreResult" class="result hidden"></div>

                <h2 style="margin-top: 30px;">Mis Puntajes</h2>
                <button onclick="getMyScores()">Ver Mis Puntajes</button>
                <div id="myScoresResult" class="result hidden"></div>

                <h2 style="margin-top: 30px;">üèÜ Tabla de Clasificaci√≥n</h2>
                <button onclick="getLeaderboard()">Ver Leaderboard</button>
                <div id="leaderboardResult" class="result hidden"></div>
            </div>

            <!-- Tab: Estad√≠sticas -->
            <div id="statsTab" class="tab-content">
                <h2>üìä Mis Estad√≠sticas</h2>
                <button onclick="getStats()">Ver Estad√≠sticas</button>
                <div id="statsResult" class="result hidden"></div>

                <h2 style="margin-top: 30px;">üë§ Mi Perfil</h2>
                <button onclick="getProfile()">Ver Perfil Completo</button>
                <div id="profileResult" class="result hidden"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/api';

        // Verificar estado del servidor al cargar
        window.onload = () => {
            checkServer();
            updateUserInfo();
        };

        async function checkServer() {
            try {
                const response = await fetch('http://localhost:3001/');
                if (response.ok) {
                    document.getElementById('serverStatus').innerHTML = '<span class="success">‚úÖ Conectado</span>';
                }
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = '<span class="error">‚ùå Desconectado</span>';
            }
        }

        function showTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

            // Mostrar el tab seleccionado
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function updateUserInfo() {
            const token = localStorage.getItem('token');
            const userName = localStorage.getItem('userName');
            const highestScore = localStorage.getItem('highestScore') || 0;

            if (token && userName) {
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('userName').textContent = userName;
                document.getElementById('highestScore').textContent = highestScore;
            }
        }

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.classList.remove('hidden');
            element.innerHTML = `<span class="${isError ? 'error' : 'success'}">${isError ? '‚ùå' : '‚úÖ'}</span>\n${JSON.stringify(data, null, 2)}`;
        }

        async function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();
                
                if (data.success) {
                    localStorage.setItem('token', data.data.token);
                    localStorage.setItem('userName', data.data.name);
                    localStorage.setItem('userId', data.data._id);
                    localStorage.setItem('highestScore', data.data.highestScore);
                    updateUserInfo();
                }

                showResult('registerResult', data, !data.success);
            } catch (error) {
                showResult('registerResult', { error: error.message }, true);
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (data.success) {
                    localStorage.setItem('token', data.data.token);
                    localStorage.setItem('userName', data.data.name);
                    localStorage.setItem('userId', data.data._id);
                    localStorage.setItem('highestScore', data.data.highestScore);
                    updateUserInfo();
                }

                showResult('loginResult', data, !data.success);
            } catch (error) {
                showResult('loginResult', { error: error.message }, true);
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userName');
            localStorage.removeItem('userId');
            localStorage.removeItem('highestScore');
            document.getElementById('userInfo').classList.add('hidden');
            location.reload();
        }

        async function saveScore() {
            const score = parseInt(document.getElementById('scoreValue').value);
            const level = parseInt(document.getElementById('scoreLevel').value);
            const token = localStorage.getItem('token');

            if (!token) {
                showResult('scoreResult', { error: 'Debes iniciar sesi√≥n primero' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_URL}/scores`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ score, level })
                });

                const data = await response.json();
                
                if (data.success && data.data.isNewRecord) {
                    localStorage.setItem('highestScore', data.data.highestScore);
                    updateUserInfo();
                }

                showResult('scoreResult', data, !data.success);
            } catch (error) {
                showResult('scoreResult', { error: error.message }, true);
            }
        }

        async function getMyScores() {
            const token = localStorage.getItem('token');

            if (!token) {
                showResult('myScoresResult', { error: 'Debes iniciar sesi√≥n primero' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_URL}/scores/my-scores`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                showResult('myScoresResult', data, !data.success);
            } catch (error) {
                showResult('myScoresResult', { error: error.message }, true);
            }
        }

        async function getLeaderboard() {
            const token = localStorage.getItem('token');

            if (!token) {
                showResult('leaderboardResult', { error: 'Debes iniciar sesi√≥n primero' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_URL}/scores/leaderboard?limit=10`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                showResult('leaderboardResult', data, !data.success);
            } catch (error) {
                showResult('leaderboardResult', { error: error.message }, true);
            }
        }

        async function getStats() {
            const token = localStorage.getItem('token');

            if (!token) {
                showResult('statsResult', { error: 'Debes iniciar sesi√≥n primero' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_URL}/scores/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                showResult('statsResult', data, !data.success);
            } catch (error) {
                showResult('statsResult', { error: error.message }, true);
            }
        }

        async function getProfile() {
            const token = localStorage.getItem('token');

            if (!token) {
                showResult('profileResult', { error: 'Debes iniciar sesi√≥n primero' }, true);
                return;
            }

            try {
                const response = await fetch(`${API_URL}/auth/profile`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                showResult('profileResult', data, !data.success);
            } catch (error) {
                showResult('profileResult', { error: error.message }, true);
            }
        }
    </script>
</body>
</html>
